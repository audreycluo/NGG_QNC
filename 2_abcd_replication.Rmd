---
title: "2_abcd_replication"
author: "Audrey"
date: "9/30/2021"
output: html_document
---

```{r}
library(dplyr)
library(tidyr)
library(nnet)
library(ggplot2)
library(ggpubr)
library(nlme)
library(Hmisc)
abcd <- read.csv("/Users/audreyluo/Box/PhD_Land/Aaron/data/ABCD_data_withQC.csv")
pnc  <- read.csv("/Users/audreyluo/Box/PhD_Land/Aaron/scripts/10042021_imaging_PRS_clinical.csv") 
abcd_pc <- read.table("/Users/audreyluo/Box/PhD_Land/Aaron/data/ABCD_PCsforGWAS_European.txt")
vol_indices <- seq(226, 325, 3)
 
colnames(abcd)[vol_indices] <- paste("Vol", colnames(abcd)[vol_indices], sep = "_")
#names(abcd)
#names(pnc)
 
```



clean data
```{r}

#remove all the rows with missing imaging from PNC 
rm <- which(is.na(pnc$lh_CT_bankssts), arr.ind=TRUE)
pnc_imaging <- pnc[-rm,] 
dim(pnc_imaging) #only 702 people have full imaging
  

which(is.na(abcd$rh_CT_frontalpole), arr.ind=TRUE)
abcd <- abcd[-2704,] # clean abcd up too
 
dim(abcd)
# need to add (5118 - 702) NA's to every column of abcd

#need to invert gestational age PRS (since PRS is higher for later birth)
abcd <- abcd %>% mutate(ga_PRS_inverse = -1*(ga_pgs), birthwt_kg = bw/35.274)

#reorder abcd_pc and cbind to abcd 
abcd_pc$V1 <- gsub(x = abcd_pc$V1, pattern = "NDAR_", replacement = "sub-NDAR") 


abcd_pc_ordered <- abcd_pc[match(abcd$participant, abcd_pc$V1),]
names(abcd_pc_ordered)[1] <- "participant"
names(abcd_pc_ordered)[2:33] <- c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12", "PC13", "PC14", "PC15", "PC16", "PC17", "PC18", "PC19", "PC20", "PC21", "PC22", "PC23", "PC24", "PC25", "PC26", "PC27", "PC28", "PC29", "PC30", "PC31", "PC32")
identical(as.character(abcd$participant), abcd_pc_ordered$PC1)


abcd <- as.data.frame(cbind(abcd, abcd_pc_ordered))
names(abcd)
which(names(abcd) == "PC10")
 
cols.num <- c(337:346)
abcd[cols.num] <- sapply(abcd[cols.num],as.numeric)
sapply(abcd, class) 
``` 

 
# impute NA's in PNC - replace with mean. This is necessary for abcd/pnc to have the same length
```{r}
to_impute <- data.frame(matrix(NA, nrow = 4416, ncol = ncol(pnc_imaging)))
names(to_impute) <- names(pnc_imaging)
mean(pnc_imaging$lh_SA_bankssts, na.rm=TRUE)  
impute(pnc_imaging$lh_SA_bankssts, mean)
 
pnc_imputed <- as.data.frame(rbind(pnc_imaging, to_impute))
 
# for each imaging phenotype in PNC, impute the mean for all the missing NA's
imaging_vars_pnc <- names(pnc_imaging)[136:449]
imaging_vars_pnc <- imaging_vars_pnc[-c(69:73)]
imaging_vars_pnc <- imaging_vars_pnc[-c(137, 172, 207)]
 
for (i in 1:length(imaging_vars_pnc))
{ 
  index <- which(names(pnc_imputed) == imaging_vars_pnc[i])
  pnc_imputed[, index] <- impute(pnc_imputed[,index], mean)
  
}   

identical(mean(pnc_imputed$Vol_paracentral), mean(pnc$Vol_paracentral, na.rm = TRUE))

# find the variable in pnc that matches abcd imaging  phenotype
# find the correlation and p-val between them
 
dim(pnc_imputed)
dim(abcd)
 
 
#  extract the relevant pnc and abcd columns 
 
pnc_imputed <- pnc_imputed[,which(names(pnc_imputed) %in% imaging_vars_pnc)] # choose the columns that are imaging
pnc_imputed_ordered <- pnc_imputed[,imaging_vars_pnc] #put the columns in order. pnc_imputed_ordered has only the imaging variables i want
identical(pnc_imputed$Vol_parsopercularis, pnc_imputed_ordered$Vol_parsopercularis)

abcd_ordered <- abcd[,which(names(abcd) %in% imaging_vars_pnc)]
names(abcd_ordered)
abcd_ordered <- abcd_ordered[,imaging_vars_pnc] #abcd_ordered_ordered has only the imaging variables i want
setdiff(names(pnc_imputed_ordered), names(abcd_ordered))
identical(abcd$Vol_parsopercularis, abcd_ordered$Vol_parsopercularis)
 
identical(names(abcd_ordered), names(pnc_imputed_ordered))
``` 

 
# correlation between imaging phenotypes across PNC/ABCD
```{r}

abcd_pnc_corr <- data.frame(matrix(NA, nrow = length(imaging_vars_pnc), ncol = 2))
names(abcd_pnc_corr) <- c('corrcoef', 'p.val')

for (i in 1:ncol(pnc_imputed))
{ 
  cat('Running t test', i, ' of ', ncol(pnc_imputed))
  res <- cor.test(pnc_imputed[,i], abcd_ordered[,i], use = 'complete.obs') 
  abcd_pnc_corr[i, 1] <- res$estimate
  abcd_pnc_corr[i, 2] <- res$p.value
  rownames(abcd_pnc_corr)[i] <- names(pnc_imputed)[i]
}
rownames(abcd_pnc_corr)[which(abcd_pnc_corr$p.val < 0.05)]
     
```

 
# Gestational age and birthweight PRS associations with ga / bw
linear models and ordinal logistic regression (check assumptions)
```{r}

  
# explore data a bit....
library("ggpubr")
library("car")
 
 
# do linear models
names(abcd)

#lme(fixed, data, random, correlation, weights, subset, method, na.action, control, contrasts = NULL, keep.data = TRUE)

 
#gestage_prs <- lme(premature ~ sex + ga_PRS_inverse, data=abcd, random = ~1|site, na.action = na.omit, random = ~1|site, na.action = na.omit)
# summary(gestage_prs) 
 
 
#ummary(gestage_prs) 
bw_prs <- lm(birthwt_kg ~ sex + bw_pgs + age_days, data=abcd) 
summary(bw_prs) 
bw_prs_noage <- lm(birthwt_kg ~ sex + bw_pgs, data=abcd) 
summary(bw_prs_noage) 
bw_prs_pc <- lm(birthwt_kg ~ sex + bw_pgs + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd) 
summary(bw_prs_pc)   
summary(bw_prs_noage) 


# logistic regression
glm_gestage_PRS  <- glm(premature ~ sex + ga_PRS_inverse + age_days, data=abcd, na.action = na.omit, family = "binomial")
summary(glm_gestage_PRS)

glm_gestage_PRS_noage  <- glm(premature ~ sex + ga_PRS_inverse, data=abcd, na.action = na.omit, family = "binomial")
summary(glm_gestage_PRS_noage)
 
glm_gestage_PRS.pc  <- glm(premature ~ sex + ga_PRS_inverse + age_days + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, na.action = na.omit, family = "binomial")
summary(glm_gestage_PRS.pc)
summary(glm_gestage_PRS_noage)

exp(cbind(OR = coef(glm_gestage_PRS), confint(glm_gestage_PRS)))   # odds ratio of infinity = no changes in odds

#try... 
test <- multinom(premature_factorized ~ sex + ga_PRS_inverse, data=abcd, random = ~1|site, na.action = na.omit)
summary(test)

 
#calculate p-values (since multinom doesn't provide pvals)
z <- summary(test)$coefficients/summary(test)$standard.errors
z
p <- (1 - pnorm(abs(z), 0, 1)) * 2 #2-tailed z
p

  
exp(coef(test)) #odds ratio 
 
library(RVAideMemoire)
library(broom)
exp(coef(test))
oddsratio_df <- OR.multinom(test, ga_PRS_inverse, conf.level = 0.95)
(tidy(test, conf.int = TRUE, conf.level = 0.95, exponentiate = TRUE)) 
# not distinguishing btwn preterm/full 
 

#compare to PNC
pnc <- read.csv("/Users/audreyluo/Box/PhD_Land/Aaron/scripts/09292021_imaging_PRS_clinical.csv") 
gestation_age_PRS_lm <- lm(gest_age ~ sex + ga_PRS_inverse + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc) 
summary(gestation_age_PRS_lm)  

glm_gestage_pnc <- glm(term_statusBINARY ~ sex + ga_PRS_inverse, data=pnc, family = "binomial")
summary(glm_gestage_pnc)
exp(cbind(OR = coef(glm_gestage_pnc), confint(glm_gestage_pnc)))  
 

 
birthweight_PRS_lm <- lm(birthwt_kg ~ sex + bw_PRS_std + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc) 
summary(birthweight_PRS_lm)

 

#similar correlation
cor(abcd$bw, abcd$bw_pgs, use= "complete.obs")
cor(pnc$birthwt_kg, pnc$bw_PRS_std, use= "complete.obs")
 
 
mean(abcd$birthwt_kg, na.rm=TRUE)
mean(pnc$birthwt_kg, na.rm=TRUE)

 
 
temp <- as.data.frame(rbind(mean(abcd$bw_pgs, na.rm=TRUE), mean(pnc$bw_PRS_std, na.rm=TRUE), mean(abcd$ga_PRS_inverse, na.rm=TRUE), mean(pnc$ga_PRS_inverse, na.rm=TRUE)))
rownames(temp) <- c("mean ABCD bw prs", "mean PNC bw prs", "mean ABCD ga prs", "mean PNC ga prs")
 
```

 
# figure for bw phenotype and PRS association (not making one for preterm since it's binomial)
```{r}

library("RColorBrewer")
 
model=lm(birthwt_kg ~ sex + bw_pgs + age_days, data=abcd)
  
summary(model)

  

(abcd_phen_bwPRS <- ggplot(data=abcd,aes(y=birthwt_kg, x=bw_pgs)) +
  geom_point(alpha = 0.7, size = 2, color = '#4393C3') + geom_smooth(method = "lm", se = FALSE, colour='#D6604D', size = 0.5) + theme(axis.text.x=element_text(size=15), axis.title.x=element_text(size=12), axis.title.y=element_text(size=12)) + ggtitle("ABCD") + labs(x="Birthweight PRS", y="Birthweight (kg)", shape = "", color = "") + theme_classic() + stat_cor(method = "pearson",label.x.npc = 0.01, label.y.npc = 0.8,size = 5))

ggsave(abcd_phen_bwPRS, file="abcd_birthwtPRS.pdf", width = 4, height=4, dpi=300)
cor.test(abcd$birthwt_kg, abcd$bw_pgs)
 

 
```

# figure - blank brain
```{r}

ggseg(position="stacked", colour="black",size=.8) + theme_void()

```

  
# linear mixed models of phenotype (premature and bw) and imaging (for abcd) 
```{r}

# premature (0/1) and imaging

d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))

abcd_imag_gestage <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag_gestage)))
b <-  which(grepl("meanCT", colnames(abcd_imag_gestage)))

abcd_imag_gestage <-as.data.frame(abcd_imag_gestage[,c(a:b)])
#names(abcd_imag_gestage)[c(a:b)] 
 
abcd_imag.gestage_coef <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag.gestage_coef) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
 
list_var <- c() 
for (i in 1:length(abcd_imag_gestage)) { 
  variable <- abcd_imag_gestage[,i]
  cat(i, "of", length(abcd_imag_gestage), "\n")
  lme_abcd <- lme(variable ~ sex + premature + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.gestage_coef[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag_gestage)[i]
}
 
abcd_imag.gestage_coef <- cbind(list_var, abcd_imag.gestage_coef) 
length(which(abcd_imag.gestage_coef$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.gestage_coef$`p-value`, method="BH") < 0.05)) # many significant hits for premature variable
  

# birthweight and imaging
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
f <- which(grepl("rh_SA_supramarginal", colnames(abcd))) # idk why this is brekaing my code but im taking it out
abcd_imag_bw <- as.data.frame(abcd[, -c(e,d,f)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag_bw)))
b <-  which(grepl("meanCT", colnames(abcd_imag_bw)))

abcd_imag_bw <-as.data.frame(abcd_imag_bw[,c(a:b)])
#names(abcd_imag_bw)[c(a:b)] 
 
abcd_imag.bw_coef <- data.frame(matrix(NA, nrow = 308, ncol = 5))
names(abcd_imag.bw_coef) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
 
list_var <- c() 
for (i in 1:length(abcd_imag_bw)) { 
  variable <- abcd_imag_bw[,i]
  cat(i, "of", length(abcd_imag_bw), "\n")
  lme_abcd <- lme(variable ~ sex + birthwt_kg + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.bw_coef[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag_bw)[i]
}
 
abcd_imag.bw_coef <- cbind(list_var, abcd_imag.bw_coef) 
length(which(abcd_imag.bw_coef$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.bw_coef$`p-value`, method="BH") < 0.05)) # many significant hits for birthweight
   
```

# linear models of phenotype and imaging (abcd) with PC's
```{r}

# premature (0/1) and imaging
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))

abcd_imag_gestage.pc <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag_gestage.pc)))
b <-  which(grepl("meanCT", colnames(abcd_imag_gestage.pc)))

abcd_imag_gestage.pc <-as.data.frame(abcd_imag_gestage.pc[,c(a:b)])
#names(abcd_imag_gestage.pc)[c(a:b)] 
 
abcd_imag.gestage.pc_coef <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag.gestage.pc_coef) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
 
list_var <- c() 
for (i in 1:length(abcd_imag_gestage.pc)) { 
  variable <- abcd_imag_gestage.pc[,i]
  cat(i, "of", length(abcd_imag_gestage.pc), "\n")
  lme_abcd <- lme(variable ~ sex + premature + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.gestage.pc_coef[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag_gestage.pc)[i]
}
 
abcd_imag.gestage.pc_coef <- cbind(list_var, abcd_imag.gestage.pc_coef) 
length(which(abcd_imag.gestage.pc_coef$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.gestage.pc_coef$`p-value`, method="BH") < 0.05)) # many significant hits for premature variable
  

# birthweight and imaging
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
f <- which(grepl("rh_SA_supramarginal", colnames(abcd))) # idk why this is brekaing my code but im taking it out
abcd_imag_bw.pc <- as.data.frame(abcd[, -c(e,d,f)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag_bw.pc)))
b <-  which(grepl("meanCT", colnames(abcd_imag_bw.pc)))

abcd_imag_bw.pc <-as.data.frame(abcd_imag_bw.pc[,c(a:b)])
#names(abcd_imag_bw.pc)[c(a:b)] 
 
abcd_imag.bw.pc_coef <- data.frame(matrix(NA, nrow = 308, ncol = 5))
names(abcd_imag.bw.pc_coef) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
 
list_var <- c() 
for (i in 1:length(abcd_imag_bw.pc)) { 
  variable <- abcd_imag_bw.pc[,i]
  cat(i, "of", length(abcd_imag_bw.pc), "\n")
  lme_abcd <- lme(variable ~ sex + birthwt_kg + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.bw.pc_coef[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag_bw.pc)[i]
}
 
abcd_imag.bw.pc_coef <- cbind(list_var, abcd_imag.bw.pc_coef) 
length(which(abcd_imag.bw.pc_coef$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.bw.pc_coef$`p-value`, method="BH") < 0.05)) # many significant hits for birthweight
   



mean(abcd_imag.gestage.pc_coef$Value[which(p.adjust(abcd_imag.gestage.pc_coef$`p-value`, method="BH") < 0.05)])
mean(abcd_imag.gestage_coef$Value[which(p.adjust(abcd_imag.gestage_coef$`p-value`, method="BH") < 0.05)])

setdiff(which(p.adjust(abcd_imag.bw.pc_coef$`p-value`, method="BH") < 0.05), which(p.adjust(abcd_imag.bw_coef$`p-value`, method="BH") < 0.05))
```


# figures for birthwt vs imaging for abcd  
 
https://arxiv.org/pdf/1912.08200.pdf
https://github.com/ggseg/ggseg/issues/5
https://drmowinckels.io/blog/2018-08-24-introducing-the-ggseg-r-package-for-brain-segmentations/
https://r-charts.com/miscellaneous/ggseg/
- The coefficient t-value is a measure of how many standard deviations our coefficient estimate is far away from 0
```{r}
  
  
abcd_imag.bw_coef
length(which(abcd_imag.bw_coef$`p-value` < 0.05))
x <- abcd_imag.bw_coef$list_var[which(p.adjust(abcd_imag.bw_coef$`p-value`, method="BH") < 0.05)] #many significant hits in bwPRS
length(x)
lh <- as.character(x[which(grepl("lh", x))])
rh <- as.character(x[which(grepl("rh", x))]) 
lh <- gsub(x = lh, pattern = "lh_", replacement = "")
rh <- gsub(x = rh, pattern = "rh_", replacement = "")
setdiff(lh,rh)

# just do totals for birthweight prs/imaging
## subset the totals
 
abcd_bw_totals <- abcd_imag.bw_coef[207:305,]
hits <- abcd_bw_totals$list_var[which(p.adjust(abcd_bw_totals$`p-value`, method="BH") < 0.05)]
hits_index <- which(p.adjust(abcd_bw_totals$`p-value`, method="BH") < 0.05)
 
# is there one phenotype that is more prominent than the others? (i.e. CT vs vol vs SA). 30 Vol, 31 SA, 7 CT

# get row number in abcd_bw_totals that corresponds to vol
vol <- hits[which(grepl("Vol_", hits))]  
vol_index <- c()
for (i in 1:length(vol)) 
{ vol_index[i] <- which(vol[i] == abcd_bw_totals$list_var)
  }
   
# get row number in abcd_bw_totals that corresponds to sa
sa <- hits[which(grepl("SA_", hits))]
sa_index <- c()
for (i in 1:length(sa)) 
{ sa_index[i] <- which(sa[i] == abcd_bw_totals$list_var)
  }
  
# get row number in abcd_bw_totals that corresponds to sa
CT <- hits[which(grepl("CT_", hits))]
CT_index <- c()
for (i in 1:length(CT)) 
{ CT_index[i] <- which(CT[i] == abcd_bw_totals$list_var)
  }
  
 
vol1 <- gsub(x= vol, pattern = "Vol_", replacement = "")
sa1 <- gsub(x= sa, pattern = "SA_", replacement = "") #has parahippocampal but vol doesn't 

cbind(vol1, sa1)


# get the t-values for the imaging phenotypes that survive correction and order them. can technically compare beta coeffs within each phenotype. but i wanna see which phenotype has the strongest effects. Looks like SA and Vol have similar t-value means and pvalues. 
as.data.frame(cbind(as.vector(abcd_bw_totals$list_var[sa_index]), abcd_bw_totals$` t-value`[sa_index], abcd_bw_totals$`p-value`[sa_index]))

mean(abcd_bw_totals$` t-value`[sa_index]) # surface area seems to have greater effect
mean(abcd_bw_totals$` t-value`[vol_index])
mean(abcd_bw_totals$` t-value`[CT_index])
mean(abcd_bw_totals$`p-value`[sa_index])
mean(abcd_bw_totals$`p-value`[vol_index])
mean(abcd_bw_totals$`p-value`[CT_index])

# make subset of data for just cortical volume
cortvol <- abcd_bw_totals[vol_index,]
cortvol$list_var
cortvol$list_var <- gsub(cortvol$list_var, pattern="Vol_", replacement="")
cortvol$list_var <- gsub(cortvol$list_var, pattern="caudal", replacement="caudal ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="anterior", replacement="anterior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="superior", replacement="superior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="inferior", replacement="inferior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="posterior", replacement="posterior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="lateral", replacement="lateral ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="middle", replacement="middle ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="medial", replacement="medial ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="pars", replacement="pars ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="isthmus", replacement="isthmus ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="rostral", replacement="rostral ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="transverse", replacement="transverse ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="frontalpole", replacement="frontal pole")
cortvol$list_var <- gsub(cortvol$list_var, pattern="temporalpole", replacement="temporal pole")
names(cortvol)[1] <- "region"
names(cortvol)[5] <- "tval"
cortvol$region

# make the image
  
library(tidyverse)
library(ggseg)
(cortvol.fig <- cortvol %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") + scale_fill_gradientn(colours= c("#053061", "#2166AC" ,  "#4393C3", "#F7F7F7" , "#FDDBC7", "#F4A582" ,  "#D6604D",  "#B2182B" , "#67001F")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom", legend.text = element_text(size = 8)) +
  ggtitle("Birthweight predicts Cortical Volume (ABCD)"))
ggsave(cortvol.fig, file="abcd_bw_cortvol.pdf", width = 6, height=4, dpi=300)
   
display.brewer.pal(n = 15, name = 'RdBu')
brewer.pal(n = 11, name = 'RdBu') 
  
# make subset of data for just surface area
surfarea <- abcd_bw_totals[sa_index,]
surfarea$list_var
surfarea$list_var <- gsub(surfarea$list_var, pattern="SA_", replacement="")
surfarea$list_var <- gsub(surfarea$list_var, pattern="caudal", replacement="caudal ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="anterior", replacement="anterior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="superior", replacement="superior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="inferior", replacement="inferior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="posterior", replacement="posterior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="lateral", replacement="lateral ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="middle", replacement="middle ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="medial", replacement="medial ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="pars", replacement="pars ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="isthmus", replacement="isthmus ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="rostral", replacement="rostral ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="transverse", replacement="transverse ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="frontalpole", replacement="frontal pole")
surfarea$list_var <- gsub(surfarea$list_var, pattern="temporalpole", replacement="temporal pole")
names(surfarea)[1] <- "region"
names(surfarea)[5] <- "tval"
surfarea$region

# surface area -- make the image 
library(tidyverse)
library(ggseg)
(surfarea.fig <- surfarea %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") + scale_fill_gradientn(colours= c("#053061", "#2166AC" ,  "#4393C3", "#D1E5F0", "#FDDBC7", "#F4A582" ,  "#D6604D", "#67001F")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Surface Area"))
ggsave(surfarea.fig, file="abcd_bw_surfarea.pdf", width = 6, height=4, dpi=300)
  


# make subset of data for just cortical thickness
cortthick <- abcd_bw_totals[CT_index,]
cortthick$list_var
cortthick$list_var <- gsub(cortthick$list_var, pattern="CT_", replacement="")
cortthick$list_var <- gsub(cortthick$list_var, pattern="caudal", replacement="caudal ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="anterior", replacement="anterior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="superior", replacement="superior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="inferior", replacement="inferior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="posterior", replacement="posterior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="lateral", replacement="lateral ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="middle", replacement="middle ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="medial", replacement="medial ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="pars", replacement="pars ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="isthmus", replacement="isthmus ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="rostral", replacement="rostral ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="transverse", replacement="transverse ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="frontalpole", replacement="frontal pole")
cortthick$list_var <- gsub(cortthick$list_var, pattern="temporalpole", replacement="temporal pole")
names(cortthick)[1] <- "region"
names(cortthick)[5] <- "tval"
cortthick$region

# cortical thickness -- make the image
  
library(tidyverse)
library(ggseg)
(cortthick.fig <- cortthick %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") +  scale_fill_gradientn(colours= hcl.colors(12, "RdBu")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Cortical Thickness"))

(cortthick.fig <- cortthick %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") +  scale_fill_gradientn(colours= c("#053061", "#2166AC" ,  "#4393C3", "#92C5DE", "#D1E5F0", "#F7F7F7" , "#FDDBC7", "#F4A582" ,  "#D6604D")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Cortical Thickness"))
ggsave(cortthick.fig, file="abcd_bw_cortthick.pdf", width = 6, height=4, dpi=300)
   



```
 
 
 
 
# figures for prematurity vs imaging for abcd  
```{r}
abcd_imag.gestage_coef

length(which(abcd_imag.gestage_coef$`p-value` < 0.05))
x <- abcd_imag.gestage_coef$list_var[which(p.adjust(abcd_imag.gestage_coef$`p-value`, method="BH") < 0.05)] #many significant hits in gestagePRS
length(x)
lh <- as.character(x[which(grepl("lh", x))])
rh <- as.character(x[which(grepl("rh", x))]) 
lh <- gsub(x = lh, pattern = "lh_", replacement = "")
rh <- gsub(x = rh, pattern = "rh_", replacement = "")
setdiff(lh,rh)

# just do totals for birthweight prs/imaging
## subset the totals
abcd_imag.gestage_coef$list_var
abcd_gestage_totals <- abcd_imag.gestage_coef[208:306,]
hits <- abcd_gestage_totals$list_var[which(p.adjust(abcd_gestage_totals$`p-value`, method="BH") < 0.05)]
hits_index <- which(p.adjust(abcd_gestage_totals$`p-value`, method="BH") < 0.05)
 
# is there one phenotype that is more prominent than the others? (i.e. CT vs vol vs SA). 30 Vol, 31 SA, 7 CT

# get row number in abcd_gestage_totals that corresponds to vol
vol <- hits[which(grepl("Vol_", hits))]  
vol_index <- c()
for (i in 1:length(vol)) 
{ vol_index[i] <- which(vol[i] == abcd_gestage_totals$list_var)
  }
   
# get row number in abcd_gestage_totals that corresponds to sa
sa <- hits[which(grepl("SA_", hits))]
sa_index <- c()
for (i in 1:length(sa)) 
{ sa_index[i] <- which(sa[i] == abcd_gestage_totals$list_var)
  }
  
# get row number in abcd_gestage_totals that corresponds to sa
CT <- hits[which(grepl("CT_", hits))]
CT_index <- c()
for (i in 1:length(CT)) 
{ CT_index[i] <- which(CT[i] == abcd_gestage_totals$list_var)
  }
  
 
vol1 <- gsub(x= vol, pattern = "Vol_", replacement = "")
sa1 <- gsub(x= sa, pattern = "SA_", replacement = "") #has parahippocampal but vol doesn't 

cbind(vol1, sa1)


# get the t-values for the imaging phenotypes that survive correction and order them. can technically compare beta coeffs within each phenotype. but i wanna see which phenotype has the strongest effects. Looks like SA and Vol have similar t-value means and pvalues. 
as.data.frame(cbind(as.vector(abcd_gestage_totals$list_var[sa_index]), abcd_gestage_totals$` t-value`[sa_index], abcd_gestage_totals$`p-value`[sa_index]))

mean(abcd_gestage_totals$` t-value`[sa_index]) # surface area seems to have greater effect
mean(abcd_gestage_totals$` t-value`[vol_index])
mean(abcd_gestage_totals$` t-value`[CT_index])
mean(abcd_gestage_totals$`p-value`[sa_index])
mean(abcd_gestage_totals$`p-value`[vol_index])
mean(abcd_gestage_totals$`p-value`[CT_index])

# make subset of data for just cortical volume
cortvol <- abcd_gestage_totals[vol_index,]
cortvol$list_var
cortvol$list_var <- gsub(cortvol$list_var, pattern="Vol_", replacement="")
cortvol$list_var <- gsub(cortvol$list_var, pattern="caudal", replacement="caudal ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="anterior", replacement="anterior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="superior", replacement="superior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="inferior", replacement="inferior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="posterior", replacement="posterior ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="lateral", replacement="lateral ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="middle", replacement="middle ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="medial", replacement="medial ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="pars", replacement="pars ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="isthmus", replacement="isthmus ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="rostral", replacement="rostral ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="transverse", replacement="transverse ")
cortvol$list_var <- gsub(cortvol$list_var, pattern="frontalpole", replacement="frontal pole")
cortvol$list_var <- gsub(cortvol$list_var, pattern="temporalpole", replacement="temporal pole")
names(cortvol)[1] <- "region"
names(cortvol)[5] <- "tval"
cortvol$region

# make the image
  
library(tidyverse)
library(ggseg)
(cortvol.fig <- cortvol %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") + scale_fill_gradientn(colors = c("#276419", "#4D9221", "#7FBC41","#B8E186", "#F7F7F7","#F1B6DA","#DE77AE", "#C51B7D")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Prematurity predicts Cortical Volume (ABCD)"))
ggsave(cortvol.fig, file="abcd_gestage_cortvol.pdf", width = 6, height=4, dpi=300)
   
   
display.brewer.pal(n = 11, name = 'PRGn')
brewer.pal(n = 11, name = 'PRGn')
rev(as.vector(brewer.pal(n = 11, name = 'PiYG')))
 
 
# make subset of data for just surface area
surfarea <- abcd_gestage_totals[sa_index,]
surfarea$list_var
surfarea$list_var <- gsub(surfarea$list_var, pattern="SA_", replacement="")
surfarea$list_var <- gsub(surfarea$list_var, pattern="caudal", replacement="caudal ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="anterior", replacement="anterior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="superior", replacement="superior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="inferior", replacement="inferior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="posterior", replacement="posterior ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="lateral", replacement="lateral ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="middle", replacement="middle ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="medial", replacement="medial ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="pars", replacement="pars ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="isthmus", replacement="isthmus ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="rostral", replacement="rostral ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="transverse", replacement="transverse ")
surfarea$list_var <- gsub(surfarea$list_var, pattern="frontalpole", replacement="frontal pole")
surfarea$list_var <- gsub(surfarea$list_var, pattern="temporalpole", replacement="temporal pole")
names(surfarea)[1] <- "region"
names(surfarea)[5] <- "tval"
surfarea$region

# surface area -- make the image 
library(tidyverse)
library(ggseg)
(surfarea.fig <- surfarea %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") + scale_fill_gradientn(colors = c("#276419", "#4D9221", "#7FBC41","#B8E186", "#E6F5D0")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Surface Area"))
ggsave(surfarea.fig, file="abcd_gestage_surfarea.pdf", width = 6, height=4, dpi=300)
   

display.brewer.pal(n = 11, name = 'PRGn')
brewer.pal(n = 11, name = 'PRGn')
rev(as.vector(brewer.pal(n = 11, name = 'PiYG')))
c("#276419", "#4D9221", "#7FBC41","#B8E186", "#E6F5D0", "#F7F7F7","#FDE0EF","#F1B6DA","#DE77AE", "#C51B7D", "#8E0152")

# make subset of data for just cortical thickness
cortthick <- abcd_gestage_totals[CT_index,]
cortthick$list_var
cortthick$list_var <- gsub(cortthick$list_var, pattern="CT_", replacement="")
cortthick$list_var <- gsub(cortthick$list_var, pattern="caudal", replacement="caudal ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="anterior", replacement="anterior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="superior", replacement="superior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="inferior", replacement="inferior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="posterior", replacement="posterior ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="lateral", replacement="lateral ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="middle", replacement="middle ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="medial", replacement="medial ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="pars", replacement="pars ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="isthmus", replacement="isthmus ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="rostral", replacement="rostral ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="transverse", replacement="transverse ")
cortthick$list_var <- gsub(cortthick$list_var, pattern="frontalpole", replacement="frontal pole")
cortthick$list_var <- gsub(cortthick$list_var, pattern="temporalpole", replacement="temporal pole")
names(cortthick)[1] <- "region"
names(cortthick)[5] <- "tval"
cortthick$region

# cortical thickness -- make the image
  
library(tidyverse)
library(ggseg)
(cortthick.fig <- cortthick %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "left") +   labs(fill = "t value") + scale_fill_gradientn(colors = c("#276419", "#4D9221", "#7FBC41","#B8E186", "#F7F7F7","#F1B6DA", "#C51B7D")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Cortical Thickness"))
ggsave(cortthick.fig, file="abcd_gestage_cortthick.pdf", width = 6, height=4, dpi=300)

```
 
 
# linear models of phenotype (ga/bw) and imaging (for pnc) 
```{r}

# gestational age vs imaging for PNC            
d <- which(grepl("SurfaceHoles", colnames(pnc)))
pnc_imag <- as.data.frame(pnc[,-d])
a <-  which(grepl("AsegVol_Left.Lateral.Ventricle", colnames(pnc_imag)))
b <-  which( colnames(pnc_imag) == "Vol_insula")

pnc_imag <-as.data.frame(pnc_imag[,c(a:b)])
pnc_imag_gestage <- data.frame(matrix(NA, nrow = 384, ncol = 4))
names(pnc_imag_gestage) <- c("Value", "Std.Error", " t-value", "p-value")
list_var <- c() 
for (i in 1:length(pnc_imag)) { 
  variable <- pnc_imag[,i]
  lm_pnc <- lm(variable ~  sex + gest_age + ageAtClinicalAssess1 + averageManualRating + AsegVol_SurfaceHoles + envSES + Cummulative_Stress_Load_No_Rape + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)
  pnc_imag_gestage[i, ] <- summary(lm_pnc)$coefficients[3,]
  list_var[i] <- names(pnc_imag)[i]
}
 
 
pnc_imag_gestage <- cbind(list_var, pnc_imag_gestage) 
which(pnc_imag_gestage$`p-value` < 0.05)
which(p.adjust(pnc_imag_gestage$`p-value`, method="BY") < 0.05) # no gestage - imaging results
  
# prematurity vs imaging for PNC
d <- which(grepl("SurfaceHoles", colnames(pnc)))
pnc_imag <- as.data.frame(pnc[,-d])
a <-  which(grepl("AsegVol_Left.Lateral.Ventricle", colnames(pnc_imag)))
b <-  which( colnames(pnc_imag) == "Vol_insula")

pnc_imag <-as.data.frame(pnc_imag[,c(a:b)])
pnc_imag_preterm <- data.frame(matrix(NA, nrow = 384, ncol = 4))
names(pnc_imag_preterm) <- c("Value", "Std.Error", " t-value", "p-value")
list_var <- c() 
for (i in 1:length(pnc_imag)) { 
  variable <- pnc_imag[,i]
  cat(i, "of", length(pnc_imag))
  lm_pnc <- lm(variable ~  sex + term_statusBINARY + ageAtClinicalAssess1 + averageManualRating + AsegVol_SurfaceHoles + envSES + Cummulative_Stress_Load_No_Rape + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)
  pnc_imag_preterm[i, ] <- summary(lm_pnc)$coefficients[3,]
  list_var[i] <- names(pnc_imag)[i]
}

pnc_imag_preterm <- cbind(list_var, pnc_imag_preterm) 
which(pnc_imag_preterm$`p-value` < 0.05)
which(p.adjust(pnc_imag_preterm$`p-value`, method="BH") < 0.05) # no preterm - imaging results


# birthweight vs imaging for PNC   
d <- which(grepl("SurfaceHoles", colnames(pnc)))
pnc_imag <- as.data.frame(pnc[,-d])
a <-  which(grepl("AsegVol_Left.Lateral.Ventricle", colnames(pnc_imag)))
b <-  which( colnames(pnc_imag) == "Vol_insula")

pnc_imag <-as.data.frame(pnc_imag[,c(a:b)])
pnc_imag_birthwt <- data.frame(matrix(NA, nrow = 384, ncol = 4))
names(pnc_imag_birthwt) <- c("Value", "Std.Error", " t-value", "p-value")
list_var <- c() 
for (i in 1:length(pnc_imag)) {  
  variable <- pnc_imag[,i]
  lm_pnc <- lm(variable ~  sex + birthwt_kg + ICV + ageAtClinicalAssess1 + averageManualRating + AsegVol_SurfaceHoles + envSES + Cummulative_Stress_Load_No_Rape + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)
  pnc_imag_birthwt[i, ] <- summary(lm_pnc)$coefficients[3,]
  list_var[i] <- names(pnc_imag)[i]
}
  
pnc_imag_birthwt <- cbind(list_var, pnc_imag_birthwt) 
which(pnc_imag_birthwt$`p-value` < 0.05)
which(p.adjust(pnc_imag_birthwt$`p-value`, method="BH") < 0.05) # 4 hits
  
pnc_imag_birthwt$list_var[which(p.adjust(pnc_imag_birthwt$`p-value`, method="BH") < 0.05)] 


cor.test(pnc$ICV, as.numeric(pnc$gest_age))
cor.test(pnc$ICV, pnc$birthwt_kg)
```


# figure for phenotype vs imaging for pnc?
```{r}
pnc_imag_birthwt
pnc_imag_birthwt$list_var[which(p.adjust(pnc_imag_birthwt$`p-value`, method="BH") < 0.05)] 

# just do right side for birthweight prs/imaging
which(pnc_imag_birthwt$list_var == "rh_Vol_inferiorparietal")
pnc_bw_rSA <- pnc_imag_birthwt[219,]  
pnc_bw_rVol <- pnc_imag_birthwt[323,]  
 
pnc_bw_rSA$list_var <- gsub(pnc_bw_rSA$list_var, pattern="rh_SA_", replacement="")
pnc_bw_rSA$list_var <- gsub(pnc_bw_rSA$list_var, pattern="inferior", replacement="inferior ")
pnc_bw_rSA$tval
pnc_bw_rVol$list_var <- gsub(pnc_bw_rVol$list_var, pattern="rh_Vol_", replacement="")
 
names(pnc_bw_rSA)[c(1,4)] <- c("region", "tval")
names(pnc_bw_rVol)[c(1,4)] <- c("region", "tval")
 

# make the image
  
library(tidyverse)
library(ggseg)
(pnc_bw_rSA.fig <- pnc_bw_rSA %>% 
  ggseg(mapping=aes(fill=as.numeric(tval)), position="stacked", colour="black",size=.5,show.legend = T,  hemisphere = "right") +   labs(fill = "t value") + scale_fill_gradientn(colors = hcl.colors(20, "BuPu")) + theme_void() + theme( plot.title = element_text(vjust = 9, hjust = 0.5), legend.position = "bottom",
        legend.text = element_text(size = 8)) +
  ggtitle("Birthweight predicts Inferior Parietal CT and SA"))
ggsave(pnc_bw_rSA.fig, file="pnc_bw_rSA.CT.pdf", width = 6, height=4, dpi=300)
 
```



# linear mixed models of PRS and imaging (for abcd)
```{r}
# gaPRS for ABCD
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
abcd_imag <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag)))
b <-  which(grepl("meanCT", colnames(abcd_imag)))

abcd_imag <-as.data.frame(abcd_imag[,c(a:b)])
abcd_imag_gaPRS <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag_gaPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")

list_var <- c() 
for (i in 1:length(abcd_imag)) { 
  variable <- abcd_imag[,i]
  lme_abcd <- lme(variable ~ sex + ga_PRS_inverse + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag_gaPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag)[i]
}
abcd_imag_gaPRS <- cbind(list_var, abcd_imag_gaPRS) 
which(abcd_imag_gaPRS$`p-value` < 0.05)
which(p.adjust(abcd_imag_gaPRS$`p-value`, method="BH") < 0.05) #no significant hits in gaPRS
 
  
# bwPRS for ABCD
d <- which(grepl("surfholes", colnames(abcd)))
abcd_imag <- as.data.frame(abcd[, -d])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag)))
b <-  which(grepl("meanCT", colnames(abcd_imag)))

abcd_imag <-as.data.frame(abcd_imag[,c(a:b)])
names(abcd_imag)[c(a:b)] 
abcd_imag_bwPRS <- data.frame(matrix(NA, nrow = 310, ncol = 5))
names(abcd_imag_bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")

list_var <- c() 
for (i in 1:length(abcd_imag)) { 
  variable <- abcd_imag[,i]
  lme_abcd <- lme(variable ~ sex + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag_bwPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag)[i]
}
abcd_imag_bwPRS <- cbind(list_var, abcd_imag_bwPRS) 
length(which(abcd_imag_bwPRS$`p-value` < 0.05))
length(which(p.adjust(abcd_imag_bwPRS$`p-value`, method="BH") < 0.05)) #many significant hits in bwPRS
  names(abcd)
  
#### try with etiv as covar  
  
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
abcd_imag1 <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag1)))
b <-  which(grepl("meanCT", colnames(abcd_imag1)))

abcd_imag1 <-as.data.frame(abcd_imag1[,c(a:b)])
names(abcd_imag1)[c(a:b)] 

abcd_imag1_bwPRS <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag1_bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
  
list_var <- c() 
for (i in 1:length(abcd_imag1)) { 
  variable <- abcd_imag1[,i]
  lme_abcd <- lme(variable ~ sex + bw_pgs + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag1_bwPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag1)[i]
}
abcd_imag1_bwPRS <- cbind(list_var, abcd_imag1_bwPRS) 
length(which(abcd_imag1_bwPRS$`p-value` < 0.05))
length(which(p.adjust(abcd_imag1_bwPRS$`p-value`, method="BH") < 0.05)) #no significant hits in bwPRS when control for etiv!!!
  names(abcd)  
  

summary(lm(GMV ~ ga_PRS_inverse, data =abcd))
 


summary(lm(ICV ~ ga_PRS_inverse, data = pnc))



cor.test(pnc$AsegVol_EstimatedTotalIntraCranialVol, pnc$bw_PRS_std)
cor.test(pnc$AsegVol_EstimatedTotalIntraCranialVol, pnc$ga_PRS_inverse)
```



# linear mixed models of PRS and imaging (for abcd) with PC's
```{r}
# gaPRS for ABCD
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
abcd_imag.pc <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag.pc)))
b <-  which(grepl("meanCT", colnames(abcd_imag.pc)))

abcd_imag.pc <-as.data.frame(abcd_imag.pc[,c(a:b)])
abcd_imag.pc_gaPRS <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag.pc_gaPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")

list_var <- c() 
for (i in 1:length(abcd_imag.pc)) { 
  variable <- abcd_imag.pc[,i]
  lme_abcd <- lme(variable ~ sex + ga_PRS_inverse + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.pc_gaPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag.pc)[i]
}
abcd_imag.pc_gaPRS <- cbind(list_var, abcd_imag.pc_gaPRS) 
which(abcd_imag.pc_gaPRS$`p-value` < 0.05)
which(p.adjust(abcd_imag.pc_gaPRS$`p-value`, method="BH") < 0.05) #no significant hits in gaPRS

# bwPRS for ABCD
d <- which(grepl("surfholes", colnames(abcd)))
abcd_imag.pc <- as.data.frame(abcd[, -d])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag.pc)))
b <-  which(grepl("meanCT", colnames(abcd_imag.pc)))

abcd_imag.pc <-as.data.frame(abcd_imag.pc[,c(a:b)])
names(abcd_imag.pc)[c(a:b)] 
abcd_imag.pc_bwPRS <- data.frame(matrix(NA, nrow = 310, ncol = 5))
names(abcd_imag.pc_bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")

list_var <- c() 
for (i in 1:length(abcd_imag.pc)) { 
  variable <- abcd_imag.pc[,i]
  lme_abcd <- lme(variable ~ sex + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.pc_bwPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag.pc)[i]
}
abcd_imag.pc_bwPRS <- cbind(list_var, abcd_imag.pc_bwPRS) 
length(which(abcd_imag.pc_bwPRS$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.pc_bwPRS$`p-value`, method="BH") < 0.05)) #many significant hits in bwPRS
  names(abcd)

#### try with etiv as covar  
  
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
abcd_imag.pc1 <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag.pc1)))
b <-  which(grepl("meanCT", colnames(abcd_imag.pc1)))

abcd_imag.pc1 <-as.data.frame(abcd_imag.pc1[,c(a:b)])
names(abcd_imag.pc1)[c(a:b)] 

abcd_imag.pc1_bwPRS <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag.pc1_bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
  
list_var <- c() 
for (i in 1:length(abcd_imag.pc1)) { 
  variable <- abcd_imag.pc1[,i]
  lme_abcd <- lme(variable ~ sex + bw_pgs + age_days + surfholes + etiv + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag.pc1_bwPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag.pc1)[i]
}
abcd_imag.pc1_bwPRS <- cbind(list_var, abcd_imag.pc1_bwPRS) 
length(which(abcd_imag.pc1_bwPRS$`p-value` < 0.05))
length(which(p.adjust(abcd_imag.pc1_bwPRS$`p-value`, method="BH") < 0.05)) #no significant hits in bwPRS when control for etiv!!!

  names(abcd)  
  

summary(lm(GMV ~ ga_PRS_inverse, data =abcd))
 


summary(lm(ICV ~ ga_PRS_inverse, data = pnc))



cor.test(pnc$AsegVol_EstimatedTotalIntraCranialVol, pnc$bw_PRS_std)
cor.test(pnc$AsegVol_EstimatedTotalIntraCranialVol, pnc$ga_PRS_inverse)
```


 
# mediation analysis (since etiv and GMV both cause effect of bwPRS to go away)
# sensitivity / mediation analysis
-  there is an indirect effect of the ga and bw PRS on the likelihood of psychopathology via envSES or trauma
- IV = bw PRS
- DV = imaging phenotypes
- mediator = etiv

1) Test the total effect. Here we are looking if any change in ga and bw PRS impacts the DV at all   
2) Test the effect of the independent variable on the mediator. 
3) Test the mediator's and the independent variable’s effect on the dependent variable.
4) Estimate various quantities for causal mediation analysis, meaning that we will compare the direct to the indirect effect, giving us more insight into what is going on in the data.
https://towardsdatascience.com/doing-and-reporting-your-first-mediation-analysis-in-r-2fe423b92171 
```{r}


d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
abcd_imag <- as.data.frame(abcd[, -c(e,d)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag)))
b <-  which(grepl("meanCT", colnames(abcd_imag)))
abcd_imag <-as.data.frame(abcd_imag[,c(a:b)])
#names(abcd_imag) 
 
 
#### 1) the total effect -- effect of IV on DV (bwPRS on imaging)
 
abcd_imag_bwPRS <- data.frame(matrix(NA, nrow = 309, ncol = 5))
names(abcd_imag_bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
  
list_var <- c() 
for (i in 1:length(abcd_imag)) { 
  variable <- abcd_imag[,i]
  lme_abcd <- lme(variable ~ sex + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag_bwPRS[i, ] <- summary(lme_abcd)$tTable 
  list_var[i] <- names(abcd_imag)[i]
}
abcd_imag_bwPRS <- cbind(list_var, abcd_imag_bwPRS) 
length(which(abcd_imag_bwPRS$`p-value` < 0.05))
length(which(p.adjust(abcd_imag_bwPRS$`p-value`, method="BH") < 0.05)) 

summary(lme(variable ~ sex + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)) 
 
 
##### 2) does IV have effect on mediator? bwPRS on etiv
abcd_etiv_bwPRS <- summary(lm(etiv ~ sex + bw_pgs +age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion , data=abcd))
 
  
##### 3)The effect of the mediator on the dependent variable -- etiv on imaging phenotypes
d <- which(grepl("surfholes", colnames(abcd)))
e <- which(grepl("etiv", colnames(abcd)))
f<- which(grepl("lh_SA_superiorparietal", colnames(abcd)))
abcd_imag <- as.data.frame(abcd[, -c(d, e, f)])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag)))
b <-  which(grepl("meanCT", colnames(abcd_imag)))
abcd_imag <-as.data.frame(abcd_imag[,c(a:b)])

abcd_etiv_imag <- data.frame(matrix(NA, nrow = 308, ncol = 5))
names(abcd_etiv_imag) <- c("Value", "Std.Error", "DF", " t-value", "p-value")
  
list_var <- c() 
for (i in 1:length(abcd_imag)) { 
  variable <- abcd_imag[,i]
  cat(i, "of", length(abcd_imag), "\n")
  lme_abcd <- lme(variable ~ sex + etiv + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_etiv_imag[i, ] <- summary(lme_abcd)$tTable[4,]
  list_var[i] <- names(abcd_imag)[i]
}

abcd_etiv_imag <- cbind(list_var, abcd_etiv_imag) 
length(which(abcd_etiv_imag$`p-value` < 0.05))
length(which(p.adjust(abcd_etiv_imag$`p-value`, method="BH") < 0.05)) # p values are crazy significant
# I think this is a complete mediation because bwPRS was a significant predictor of imaginig phenotypes before, but is no longer after introduction of etiv. All the information of bwPRS that was contained in the imaging phenotpes is also in etiv. The total effect of bwPRS is explained by etiv. The total effect of bwPRS onto imaging phenotype goes through etiv. 

 

##### 4) causal mediation analysis
 
  
```


# linear models of PRS and imaging (for pnc)
# can i add total volume
```{r}

names(pnc)

# gaPRS for PNC            
d <- which(grepl("SurfaceHoles", colnames(pnc)))
pnc_imag <- as.data.frame(pnc[,-d])
a <-  which(grepl("AsegVol_Left.Lateral.Ventricle", colnames(pnc_imag)))
b <-  which( colnames(pnc_imag) == "Vol_insula")

pnc_imag <-as.data.frame(pnc_imag[,c(a:b)])
pnc_imag_gaPRS <- data.frame(matrix(NA, nrow = 384, ncol = 4))
names(pnc_imag_gaPRS) <- c("Value", "Std.Error", " t-value", "p-value")
list_var <- c() 
for (i in 1:length(pnc_imag)) { 
  variable <- pnc_imag[,i]
  lm_pnc <- lm(variable ~  sex + ga_PRS_inverse + ageAtClinicalAssess1 + averageManualRating + AsegVol_SurfaceHoles + envSES + Cummulative_Stress_Load_No_Rape + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)
  pnc_imag_gaPRS[i, ] <- summary(lm_pnc)$coefficients[3,]
  list_var[i] <- names(pnc_imag)[i]
}

pnc_imag_gaPRS <- cbind(list_var, pnc_imag_gaPRS) 
which(pnc_imag_gaPRS$`p-value` < 0.05)
which(p.adjust(pnc_imag_gaPRS$`p-value`, method="BH") < 0.05) # no gaPRS - imaging results
  
# bwPRS for PNC            
d <- which(grepl("SurfaceHoles", colnames(pnc)))
pnc_imag <- as.data.frame(pnc[,-d])
a <-  which(grepl("AsegVol_Left.Lateral.Ventricle", colnames(pnc_imag)))
b <-  which( colnames(pnc_imag) == "Vol_insula")

pnc_imag <-as.data.frame(pnc_imag[,c(a:b)])
pnc_imag_bwPRS <- data.frame(matrix(NA, nrow = 384, ncol = 4))
names(pnc_imag_bwPRS) <- c("Value", "Std.Error", " t-value", "p-value")
list_var <- c() 
for (i in 1:length(pnc_imag)) {  
  variable <- pnc_imag[,i]
  lm_pnc <- lm(variable ~  sex + bw_PRS_std + ageAtClinicalAssess1 + averageManualRating + AsegVol_SurfaceHoles + envSES + Cummulative_Stress_Load_No_Rape + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)
  pnc_imag_bwPRS[i, ] <- summary(lm_pnc)$coefficients[3,]
  list_var[i] <- names(pnc_imag)[i]
}
 
pnc_imag_bwPRS <- cbind(list_var, pnc_imag_bwPRS) 
which(pnc_imag_bwPRS$`p-value` < 0.05)
which(p.adjust(pnc_imag_bwPRS$`p-value`, method="BH") < 0.05) # no bwPRS - imaging results
  
pnc_imag_bwPRS$list_var[which(pnc_imag_bwPRS$`p-value` < 0.05)] 
```

 
# correlation of beta coeff's for ga/bw PRS for pnc and abcd
```{r}
 
 
# gaPRS correlation of beta coefficients 
dim(abcd_imag_gaPRS)
dim(pnc_imag_gaPRS)

pnc_imag_gaPRS_ordered <- pnc_imag_gaPRS[match(abcd_imag_gaPRS$list_var, pnc_imag_gaPRS$list_var),]
setdiff(abcd_imag_gaPRS$list_var,  pnc_imag_gaPRS_ordered$list_var)

m  <- which(abcd_imag_gaPRS$list_var == "etiv") 
n <- which(abcd_imag_gaPRS$list_var == "meanSA") 
o <- which(abcd_imag_gaPRS$list_var == "totalSA") 
p <- which(abcd_imag_gaPRS$list_var == "meanCT") 
abcd_imag_gaPRS <- abcd_imag_gaPRS[-c(m,n,o,p),]
pnc_imag_gaPRS_ordered <- pnc_imag_gaPRS_ordered[-c(m,n,o,p),]
setdiff(abcd_imag_gaPRS$list_var,  pnc_imag_gaPRS_ordered$list_var)
     
cor.test(abcd_imag_gaPRS$Value, pnc_imag_gaPRS_ordered$Value) 

  
# gaPRS correlation of beta coefficients 
dim(abcd_imag1_bwPRS)
dim(pnc_imag_bwPRS)

pnc_imag_bwPRS_ordered <- pnc_imag_bwPRS[match(abcd_imag1_bwPRS$list_var, pnc_imag_bwPRS$list_var),]
setdiff(abcd_imag1_bwPRS$list_var,  pnc_imag_bwPRS_ordered$list_var)

m  <- which(abcd_imag1_bwPRS$list_var == "etiv") 
n <- which(abcd_imag1_bwPRS$list_var == "meanSA") 
o <- which(abcd_imag1_bwPRS$list_var == "totalSA") 
p <- which(abcd_imag1_bwPRS$list_var == "meanCT") 
abcd_imag1_bwPRS <- abcd_imag1_bwPRS[-c(m,n,o,p),]
pnc_imag_bwPRS_ordered <- pnc_imag_bwPRS_ordered[-c(m,n,o,p),]
setdiff(abcd_imag1_bwPRS$list_var,  pnc_imag_bwPRS_ordered$list_var)
     
cor.test(abcd_imag1_bwPRS$Value, pnc_imag_bwPRS_ordered$Value) 

range(abcd$age_days, na.rm=TRUE)
 
```

 
# post hoc imaging analysis: include both prs scores - not finished 

```{r}


# ga.bwPRS for ABCD
d <- which(grepl("surfholes", colnames(abcd)))
abcd_imag <- as.data.frame(abcd[, -d])
a <-  which(grepl("lh_SA_bankssts", colnames(abcd_imag)))
b <-  which(grepl("meanCT", colnames(abcd_imag)))

abcd_imag <-as.data.frame(abcd_imag[,c(a:b)])
abcd_imag_ga.bwPRS <- data.frame(matrix(NA, nrow = 310, ncol = 5))
names(abcd_imag_ga.bwPRS) <- c("Value", "Std.Error", "DF", " t-value", "p-value")

list_var <- c() 
for (i in 1:length(abcd_imag)) { 
  variable <- abcd_imag[,i]
  lme_abcd <- lme(variable ~ sex + ga_PRS_inverse + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
  abcd_imag_ga.bwPRS[i, ] <- summary(lme_abcd)$tTable[3,]
  list_var[i] <- names(abcd_imag)[i]
}


lme_abcd <- lme(lh_SA_bankssts ~ sex + ga_PRS_inverse + bw_pgs + age_days + surfholes + QC_ABCD_artifact + QC_ABCD_inhomogeneity + QC_ABCD_motion, data=abcd, random = ~1|site, na.action = na.omit)
summary(lme_abcd)$tTable 

abcd_imag_ga.bwPRS <- cbind(list_var, abcd_imag_ga.bwPRS) 
which(abcd_imag_ga.bwPRS$`p-value` < 0.05)
which(p.adjust(abcd_imag_ga.bwPRS$`p-value`, method="BH") < 0.05) #no significant hits in ga.bwPRS

 

```

# ga/bw PRS predict dx in ABCD - nothing
```{r}
levels(abcd$dx)
 

abcd$dx <- relevel(abcd$dx, ref = "CN")
test <- multinom(dx ~ sex + bw_pgs + age_days, data=abcd)
summary(test)

 
#calculate p-values (since multinom doesn't provide pvals)
z <- summary(test)$coefficients/summary(test)$standard.errors
z
p <- (1 - pnorm(abs(z), 0, 1)) * 2 #2-tailed z
p

 
#The ratio of the probability of choosing one outcome category over the probability of choosing the baseline category is often referred as relative risk 

exp(coef(test))

library(RVAideMemoire)
library(broom)
exp(coef(test))
oddsratio_df <- OR.multinom(test, dx, conf.level = 0.95)
(tidy(test, conf.int = TRUE, conf.level = 0.95, exponentiate = TRUE)) # yup
 
   
```

 
#laura a - suggestions
-- at some point would be good to include the phenotype and PRS in a single model and see what happens, even if underpowered. 
-- Also she had the idea of looking at association with PRS in full term folks only, ie to try to mitigate the effect of the phenotype per se and isolate the genetic effect
```{r}
# put phenotype and PRS in single model...

# pnc - gaPRS, gestage and imaging

names(pnc)
vol_i <-  which(grepl("AsegVol_CortexVol", colnames(pnc)))
vol_i <- append(vol_i, which(grepl("AsegVol_SubCortGrayVol", colnames(pnc))))
vol_i <- append(vol_i, which(grepl("AsegVol_CorticalWhiteMatterVol", colnames(pnc))))
vol_i <- append(vol_i, which(grepl("AsegVol_Ventricular_CSF", colnames(pnc))))
fit_gaPRS <- lapply(pnc[,vol_i], function(x) summary(lm(x ~ sex + ga_PRS_inverse + gest_age + ageAtClinicalAssess1 + averageManualRating  + AsegVol_lhSurfaceHoles + AsegVol_rhSurfaceHoles + AsegVol_SurfaceHoles + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc)))  
fit_gaPRS_pval <- lapply(pnc[,vol_i], function(x) summary(lm(x ~ sex + ga_PRS_inverse + gest_age + ageAtClinicalAssess1 + averageManualRating  + AsegVol_lhSurfaceHoles + AsegVol_rhSurfaceHoles + AsegVol_SurfaceHoles + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=pnc))$coefficients[,"Pr(>|t|)"][3])  
fit_gaPRS_sigoutcomes <- which(fit_gaPRS_pval < 0.05) 
fit_gaPRS[fit_gaPRS_sigoutcomes]  
which(p.adjust(fit_gaPRS_pval, method="BY") < 0.05)
 
```
fit_bwPRS_imaging4 <- lapply(imaging_cleaned[,vol_i], function(x) summary(lm(x ~ sex + bw_PRS_std + ageAtClinicalAssess1 + averageManualRating + AsegVol_lhSurfaceHoles + AsegVol_rhSurfaceHoles + AsegVol_SurfaceHoles + PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=imaging_cleaned)))  
fit_bwPRS_imaging4_pval <- lapply(imaging_cleaned[,vol_i], function(x) summary(lm(x ~ sex + bw_PRS_std + ageAtClinicalAssess1 + averageManualRating + AsegVol_lhSurfaceHoles + AsegVol_rhSurfaceHoles + AsegVol_SurfaceHoles +PC1 + PC2 + PC3 + PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data=imaging_cleaned))$coefficients[,"Pr(>|t|)"][3])  
fit_bwPRS_imaging4_sigoutcomes <- which(fit_bwPRS_imaging4_pval < 0.05) 
fit_bwPRS_imaging4[fit_bwPRS_imaging4_sigoutcomes]  
which(p.adjust(fit_bwPRS_imaging4_pval, method="BY") < 0.05)


```

  